<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Professional Sports Scheduling & Conflict Analysis Tool">
    <title>Pro Sports Scheduler | 2025-2026</title>
    
    <!-- Dynamic Favicon (Calendar Emoji) -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ“…</text></svg>">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/umd/lucide.min.js"></script>

    <!-- Google Fonts -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #f8fafc; /* Slate-50 */
            overscroll-behavior: none; /* Prevents bounce on Mac */
        }
        
        /* --- Grid Architecture --- */
        /* Fixed Column (League Name) + 35 Days (Flexible but min-width enforced) */
        .day-grid {
            display: grid;
            grid-template-columns: 160px repeat(35, minmax(40px, 1fr)); 
        }

        /* Sticky Headers for intuitive scrolling */
        .sticky-header { position: sticky; top: 0; z-index: 40; }
        .sticky-sub-header { position: sticky; top: 33px; z-index: 30; }
        .sticky-col { position: sticky; left: 0; z-index: 20; }
        
        /* Cell Styling */
        .week-header-cell {
            grid-column: span 7;
            text-align: center;
            font-size: 0.75rem;
            font-weight: 600;
            border-right: 1px solid #cbd5e1;
            background-color: #f1f5f9;
            padding: 6px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #475569;
        }

        .day-header-cell {
            text-align: center;
            border-right: 1px solid #e2e8f0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            padding: 4px 0;
            height: 55px;
            transition: background-color 0.2s;
        }
        
        .grid-cell {
            border-right: 1px solid #f1f5f9;
            border-bottom: 1px solid #f1f5f9;
            height: 48px; /* Fixed row height */
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 3px;
        }

        /* Bar Styling */
        .daily-bar {
            width: 100%;
            height: 28px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.65rem;
            font-weight: 700;
            color: white;
            cursor: pointer; /* Change to pointer for tooltip feel */
            transition: transform 0.1s, opacity 0.2s;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        .daily-bar:hover { 
            transform: scale(1.05); 
            z-index: 10; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        /* Status Indicators */
        .is-playoff { 
            box-shadow: 0 0 0 2px #dc2626, 0 4px 6px rgba(0,0,0,0.2); 
            z-index: 5;
            position: relative;
        }
        /* Optional: Add a pattern for TBD dates if needed later */
        .is-tbd { 
            background-image: repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,0.2) 5px, rgba(255,255,255,0.2) 10px); 
        }
        
        /* Heatmap Intensity Colors */
        .heat-low { background-color: #dcfce7; color: #166534; }      /* Green-100 */
        .heat-med { background-color: #fef9c3; color: #854d0e; }      /* Yellow-100 */
        .heat-high { background-color: #fee2e2; color: #991b1b; font-weight: 800;} /* Red-100 */
        .heat-critical { 
            background-color: #7e22ce; color: #ffffff; font-weight: 800; 
            border: 1px solid #581c87;
        } /* Purple (Playoff Clash) */

        /* Utility */
        .weekend { background-color: #f8fafc; }
        .current-month { background-color: #ffffff; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="p-4 h-screen flex flex-col text-slate-800">

    <!-- Top Control Bar -->
    <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200 mb-4 flex flex-col md:flex-row justify-between items-center gap-4 flex-none">
        <div>
            <h1 class="text-2xl font-bold text-slate-900 flex items-center gap-2">
                <i data-lucide="calendar-range" class="text-blue-600"></i>
                Pro Sports Scheduler
            </h1>
            <p class="text-xs text-slate-500 mt-1 font-medium">Strategic Conflict Analysis â€¢ 2025-2026 Cycle</p>
        </div>

        <div class="flex items-center gap-4 w-full md:w-auto">
            <div class="flex flex-col w-full md:w-auto">
                <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wide mb-1">Target Month</label>
                <select id="month-selector" class="bg-slate-50 border border-slate-300 text-slate-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full md:w-48 p-2.5 shadow-sm">
                    <!-- Options injected via JS -->
                </select>
            </div>
            
            <div class="text-right hidden md:block">
                <div class="text-[10px] font-bold text-slate-400 uppercase tracking-wide mb-1">Config</div>
                <button onclick="document.getElementById('filter-modal').classList.remove('hidden')" class="text-sm bg-white border border-slate-300 text-slate-700 px-3 py-2 rounded-lg hover:bg-slate-50 font-medium shadow-sm transition-colors flex items-center gap-2">
                    <i data-lucide="sliders-horizontal" class="w-4 h-4"></i> Filter Leagues
                </button>
            </div>
        </div>
    </div>

    <!-- Main Grid Container -->
    <div class="bg-white rounded-xl shadow-xl border border-slate-200 flex-grow flex flex-col overflow-hidden relative">
        
        <!-- Filter Modal (Hidden by default) -->
        <div id="filter-modal" class="hidden absolute inset-0 bg-slate-900/40 z-50 flex items-center justify-center backdrop-blur-[2px] transition-all">
            <div class="bg-white rounded-xl shadow-2xl p-6 w-96 max-w-[90%] border border-slate-200">
                <div class="flex justify-between items-center mb-4 border-b border-slate-100 pb-2">
                    <h3 class="text-lg font-bold text-slate-900">League Visibility</h3>
                    <button onclick="document.getElementById('filter-modal').classList.add('hidden')" class="text-slate-400 hover:text-slate-700 transition-colors">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                </div>
                <div id="league-toggles" class="space-y-2 max-h-[60vh] overflow-y-auto pr-2">
                    <!-- Toggles injected via JS -->
                </div>
                <div class="mt-6 flex justify-end pt-4 border-t border-slate-100">
                    <button onclick="document.getElementById('filter-modal').classList.add('hidden'); renderAll();" class="bg-blue-600 text-white px-5 py-2 rounded-lg hover:bg-blue-700 text-sm font-semibold shadow-md transition-colors">Apply Changes</button>
                </div>
            </div>
        </div>

        <!-- Scrollable Timeline -->
        <div id="timeline-scroll-area" class="overflow-auto flex-grow relative bg-slate-50">
            <div id="grid-container" class="min-w-[1560px] pb-4 bg-white">
                <!-- Grid injected via JS -->
            </div>
        </div>

        <!-- Legend Footer -->
        <div class="bg-slate-50 border-t border-slate-200 p-3 text-xs flex flex-wrap gap-6 items-center justify-center flex-none shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)] z-20">
            <span class="font-bold text-slate-400 uppercase tracking-wider">Analysis Legend</span>
            <div class="flex items-center gap-2 bg-white px-2 py-1 rounded border border-slate-200">
                <span class="w-2.5 h-2.5 rounded-sm bg-[#dcfce7] border border-[#166534]"></span> Low Traffic
            </div>
            <div class="flex items-center gap-2 bg-white px-2 py-1 rounded border border-slate-200">
                <span class="w-2.5 h-2.5 rounded-sm bg-[#fef9c3] border border-[#854d0e]"></span> Med Traffic
            </div>
            <div class="flex items-center gap-2 bg-white px-2 py-1 rounded border border-slate-200">
                <span class="w-2.5 h-2.5 rounded-sm bg-[#fee2e2] border border-[#991b1b]"></span> High Traffic
            </div>
            <div class="flex items-center gap-2 bg-purple-50 px-2 py-1 rounded border border-purple-200">
                <span class="w-2.5 h-2.5 rounded-sm bg-[#7e22ce]"></span> <strong class="text-purple-800">Multi-Playoff Clash</strong>
            </div>
        </div>
    </div>

    <script>
        // --- PRO CONFIGURATION & DATA ---
        
        // Month Mapping (April 2025 Start)
        const MONTHS = [
            { val: 0, name: "April 2025", year: 2025, mIdx: 3 },
            { val: 1, name: "May 2025", year: 2025, mIdx: 4 },
            { val: 2, name: "June 2025", year: 2025, mIdx: 5 },
            { val: 3, name: "July 2025", year: 2025, mIdx: 6 },
            { val: 4, name: "August 2025", year: 2025, mIdx: 7 },
            { val: 5, name: "September 2025", year: 2025, mIdx: 8 },
            { val: 6, name: "October 2025", year: 2025, mIdx: 9 }, // High conflict
            { val: 7, name: "November 2025", year: 2025, mIdx: 10 },
            { val: 8, name: "December 2025", year: 2025, mIdx: 11 },
            { val: 9, name: "January 2026", year: 2026, mIdx: 0 },
            { val: 10, name: "February 2026", year: 2026, mIdx: 1 },
            { val: 11, name: "March 2026", year: 2026, mIdx: 2 }
        ];

        const DOW_SHORT = ['Su', 'M', 'Tu', 'W', 'Th', 'F', 'Sa'];

        // --- SIMULATED DATA (2025-2026) ---
        // Edit this array to update the tool with real schedule drops.
        // Format: YYYY-MM-DD
        let rawSchedule = [
            // The 2025-2026 NFL season schedule (Regular Season and Playoffs)
            {
                id: 'nfl',
                name: "NFL",
                color: "bg-orange-500",
                visible: true,
                segments: [
                    // REGULAR SEASON: Begins Thursday, Sept 4, and ends Sunday, Jan 4.
                    { start: "2025-09-04", end: "2026-01-04", type: "Regular Season", isPlayoff: false },

                    // PLAYOFFS (Wild Card Weekend): Saturday, Jan 10 - Monday, Jan 12.
                    { start: "2026-01-10", end: "2026-01-12", type: "WC", isPlayoff: true },

                    // PLAYOFFS (Divisional Round): Saturday, Jan 17 - Sunday, Jan 18.
                    { start: "2026-01-17", end: "2026-01-18", type: "DIV", isPlayoff: true },

                    // PLAYOFFS (Conference Championships): Sunday, Jan 25.
                    { start: "2026-01-25", end: "2026-01-25", type: "CONF", isPlayoff: true },

                    // SUPER BOWL LX: Sunday, Feb 8. (The week before this is correctly left open)
                    { start: "2026-02-08", end: "2026-02-08", type: "Super Bowl LX", isPlayoff: true }
                ],
                // Primary Game Days: Sunday (0), Monday (1), Thursday (4), Saturday (6)
                primaryDays: [0, 1, 4, 6]
            }, // <-- CORRECT COMMA SEPARATOR

            {
                id: 'nba', name: "NBA", color: "bg-blue-600", visible: true,
                segments: [
                    { start: "2025-04-19", end: "2025-06-20", type: "2025 Playoffs", isPlayoff: true },
                    { start: "2025-10-22", end: "2026-03-31", type: "25-26 Season", isPlayoff: false }
                ],
                primaryDays: [2, 4, 5]
            },
            {
                id: 'mlb', name: "MLB", color: "bg-emerald-600", visible: true,
                segments: [
                    { start: "2025-03-27", end: "2025-09-28", type: "Regular Season", isPlayoff: false },
                    { start: "2025-09-30", end: "2025-11-01", type: "Postseason", isPlayoff: true }
                ],
                primaryDays: [0,1,2,3,4,5,6]
            },
            {
                id: 'ncaaf', name: "NCAA Football", color: "bg-amber-800", visible: true,
                segments: [
                    { start: "2025-08-30", end: "2025-11-29", type: "Regular Season", isPlayoff: false },
                    { start: "2025-12-19", end: "2026-01-12", type: "Bowls / CFP", isPlayoff: true }
                ],
                primaryDays: [5, 6] // Fri, Sat
            },
            {
                id: 'f1', name: "Formula 1", color: "bg-red-600", visible: true,
                segments: [
                    { start: "2025-03-14", end: "2025-12-07", type: "Race Season", isPlayoff: false }
                ],
                primaryDays: [0]
            },
            {
                id: 'nascar', name: "NASCAR", color: "bg-yellow-500", visible: true,
                segments: [
                    { start: "2025-02-16", end: "2025-09-07", type: "Cup Series", isPlayoff: false },
                    { start: "2025-09-08", end: "2025-11-09", type: "Playoffs", isPlayoff: true }
                ],
                primaryDays: [0]
            },
            {
                id: 'mls', name: "MLS", color: "bg-teal-500", visible: true,
                segments: [
                    { start: "2025-02-26", end: "2025-10-19", type: "Regular Season", isPlayoff: false },
                    { start: "2025-10-25", end: "2025-12-07", type: "Cup Playoffs", isPlayoff: true }
                ],
                primaryDays: [6, 0]
            },
            {
                id: 'nwsl', name: "NWSL", color: "bg-pink-600", visible: true,
                segments: [
                    { start: "2025-03-15", end: "2025-11-02", type: "Regular Season", isPlayoff: false },
                    { start: "2025-11-08", end: "2025-11-22", type: "Playoffs", isPlayoff: true }
                ],
                primaryDays: [5, 6, 0]
            },
            {
                id: 'march', name: "March Madness", color: "bg-slate-500", visible: true,
                segments: [
                    { start: "2026-03-17", end: "2026-04-06", type: "Tournament", isPlayoff: true }
                ],
                primaryDays: [4, 5, 6, 0]
            }
        ];

        // --- RENDER LOGIC ---

        function init() {
            // Populate Month Select
            const sel = document.getElementById('month-selector');
            MONTHS.forEach(m => {
                let opt = document.createElement('option');
                opt.value = m.val;
                opt.innerText = m.name;
                // Default to Oct '25 (High conflict month)
                if(m.val === 6) opt.selected = true; 
                sel.appendChild(opt);
            });
            sel.addEventListener('change', renderAll);

            // Populate Filter Toggles
            const toggleContainer = document.getElementById('league-toggles');
            rawSchedule.forEach(l => {
                const div = document.createElement('div');
                div.className = "flex items-center justify-between p-3 border-b border-slate-50 hover:bg-slate-50 transition-colors rounded-lg";
                div.innerHTML = `
                    <span class="flex items-center gap-3 font-medium text-sm text-slate-700">
                        <span class="w-3 h-3 rounded-full ${l.color} shadow-sm"></span> ${l.name}
                    </span>
                    <label class="inline-flex items-center cursor-pointer">
                        <input type="checkbox" class="sr-only peer" checked onchange="toggleLeague('${l.id}', this.checked)">
                        <div class="relative w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-100 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                    </label>
                `;
                toggleContainer.appendChild(div);
            });

            // Init Icons
            lucide.createIcons();
            
            // Initial Render
            renderAll();
        }

        function toggleLeague(id, isVisible) {
            const lg = rawSchedule.find(x => x.id === id);
            if(lg) lg.visible = isVisible;
        }

        function renderAll() {
            const selVal = parseInt(document.getElementById('month-selector').value);
            const monthData = MONTHS.find(m => m.val === selVal);
            const container = document.getElementById('grid-container');
            container.innerHTML = '';

            // 1. Calculate Grid Dates
            const firstDay = new Date(monthData.year, monthData.mIdx, 1);
            // Start view on the Sunday before (or on) the 1st
            let startDate = new Date(firstDay);
            startDate.setDate(firstDay.getDate() - firstDay.getDay());
            
            // Generate 35 days (5 weeks) standard view
            let days = [];
            for(let i=0; i<35; i++) {
                let d = new Date(startDate);
                d.setDate(startDate.getDate() + i);
                days.push(d);
            }

            // 2. Filter Active Leagues
            const activeLeagues = rawSchedule.filter(l => l.visible);

            // 3. Build Header Rows
            const headerRow = document.createElement('div');
            headerRow.className = "day-grid sticky-header bg-white border-b border-slate-200 shadow-sm z-40";
            
            // 3a. Week Labels
            let weekHTML = `<div class="p-4 font-bold text-slate-700 border-r border-slate-200 bg-white sticky-col flex items-center justify-end shadow-[4px_0_5px_-2px_rgba(0,0,0,0.05)]">
                <span class="text-xs uppercase tracking-widest text-slate-400">Leagues</span>
            </div>`;
            
            for(let i=0; i<5; i++) {
                let wStart = days[i*7];
                let wEnd = days[(i*7)+6];
                weekHTML += `<div class="week-header-cell">Week ${i+1} <span class="font-normal text-slate-400 normal-case ml-1 text-[10px]">(${wStart.getMonth()+1}/${wStart.getDate()} - ${wEnd.getMonth()+1}/${wEnd.getDate()})</span></div>`;
            }
            headerRow.innerHTML = weekHTML;
            
            // 3b. Congestion / Heatmap Header
            const heatRow = document.createElement('div');
            heatRow.className = "day-grid sticky-sub-header border-b border-slate-200 bg-slate-50 z-30";
            let heatHTML = `<div class="p-2 text-[10px] font-bold uppercase tracking-wider text-right border-r border-slate-200 pr-4 text-slate-400 sticky-col bg-slate-50 shadow-[4px_0_5px_-2px_rgba(0,0,0,0.05)] flex items-center justify-end">Heatmap</div>`;
            
            days.forEach(d => {
                // Calculate Congestion Score
                let score = 0;
                let playoffCount = 0;
                
                activeLeagues.forEach(lg => {
                    const seg = getSegment(lg, d);
                    if(seg) {
                        // Check if it is a primary day for the league
                        if(lg.primaryDays.includes(d.getDay())) {
                            score += 1; // Base score for active primary day
                            if(seg.isPlayoff) {
                                score += 1.5; // Playoffs weigh heavily
                                playoffCount++;
                            }
                        }
                    }
                });

                // Determine Heat Class
                let heatClass = "bg-white text-slate-300";
                if (playoffCount >= 2) heatClass = "heat-critical";
                else if (score >= 3) heatClass = "heat-high";
                else if (score >= 1.5) heatClass = "heat-med";
                else if (score > 0) heatClass = "heat-low";

                // Weekend Logic
                let isWknd = d.getDay() === 0 || d.getDay() === 6;
                let dayLabel = DOW_SHORT[d.getDay()];
                let dateNum = d.getDate();
                
                // Highlight if current month
                let isCurrent = d.getMonth() === monthData.mIdx;
                let opacity = isCurrent ? 'opacity-100' : 'opacity-40 bg-slate-100';

                heatHTML += `
                    <div class="day-header-cell ${heatClass} ${opacity} ${isWknd ? 'border-l-2 border-l-slate-200' : ''}">
                        <span class="font-bold text-[10px]">${dateNum}</span>
                        <span class="text-[9px] uppercase tracking-tighter">${dayLabel}</span>
                    </div>
                `;
            });
            heatRow.innerHTML = heatHTML;

            container.appendChild(headerRow);
            container.appendChild(heatRow);

            // 4. Render League Rows
            activeLeagues.forEach(lg => {
                const row = document.createElement('div');
                row.className = "day-grid bg-white hover:bg-slate-50 transition-colors group";
                
                // Label
                let rowHTML = `<div class="p-2 text-xs font-bold text-slate-700 border-r border-slate-200 flex items-center justify-end pr-4 sticky-col bg-white group-hover:bg-slate-50 shadow-[4px_0_5px_-2px_rgba(0,0,0,0.05)] transition-colors z-20">${lg.name}</div>`;
                
                days.forEach(d => {
                    const seg = getSegment(lg, d);
                    const isWknd = d.getDay() === 0 || d.getDay() === 6;
                    
                    let cellContent = "";
                    if(seg) {
                        // Is this a primary day for this league?
                        const isPrimary = lg.primaryDays.includes(d.getDay());
                        // Dim bar if not a primary broadcast day
                        const style = isPrimary ? lg.color : "bg-slate-300"; 
                        const opacity = isPrimary ? "opacity-100" : "opacity-40";
                        const playoffClass = seg.isPlayoff ? "is-playoff" : "";
                        
                        // Abbreviate label
                        let label = seg.type.includes("Playoff") || seg.type.includes("Post") ? "PO" : "RS";
                        if(seg.type.includes("Bowl")) label = "BOWL";
                        if(seg.type.includes("Series")) label = "WS"; // World Series

                        // Use specific abbreviations for NFL playoffs
                        if (seg.type === "WC" || seg.type === "DIV" || seg.type === "CONF") {
                            label = seg.type;
                        }
                        
                        // Tooltip text
                        const title = `${lg.name} â€¢ ${seg.type}\n${d.toDateString()}\nStatus: ${isPrimary ? 'Primary Broadcast Day' : 'Secondary/Off Day'}`;
                        
                        cellContent = `<div class="daily-bar ${style} ${opacity} ${playoffClass}" title="${title}">${label}</div>`;
                    }

                    rowHTML += `<div class="grid-cell ${isWknd ? 'bg-slate-50' : ''} ${d.getMonth() !== monthData.mIdx ? 'bg-slate-100/50' : ''}">${cellContent}</div>`;
                });

                row.innerHTML = rowHTML;
                container.appendChild(row);
            });
        }

        // Helper: Get segment for date
        function getSegment(league, dateObj) {
            const t = dateObj.getTime();
            // Use Noon to avoid timezone edge cases
            const check = new Date(dateObj.getFullYear(), dateObj.getMonth(), dateObj.getDate(), 12, 0, 0).getTime();

            return league.segments.find(s => {
                // Parse YYYY-MM-DD
                let [sy, sm, sd] = s.start.split('-').map(Number);
                let [ey, em, ed] = s.end.split('-').map(Number);
                // Create Date objects (Month is 0-indexed in JS Date)
                let start = new Date(sy, sm-1, sd, 0, 0, 0).getTime();
                let end = new Date(ey, em-1, ed, 23, 59, 59).getTime();
                return check >= start && check <= end;
            });
        }

        // Start App
        init();
        
        // Final Fix: Add logic to display WC, DIV, CONF labels correctly
        // This was added in renderAll function, under section 4, cellContent assignment.
    </script>
</body>
</html>

